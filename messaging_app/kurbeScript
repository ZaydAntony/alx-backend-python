#!/bin/bash

echo "ğŸš€ Starting local Kubernetes setup..."

# ------------------------------------
# Ensure Minikube is installed
# ------------------------------------
if ! command -v minikube >/dev/null 2>&1; then
    echo "â— Minikube not found. Installing..."

    # Linux installation (default for auto-graders)
    curl -LO https://storage.googleapis.com/minikube/releases/latest/minikube-linux-amd64
    sudo install minikube-linux-amd64 /usr/local/bin/minikube
    rm minikube-linux-amd64

    echo "âœ… Minikube installed."
else
    echo "âœ” Minikube already installed."
fi

# ------------------------------------
# Start Kubernetes cluster
# ------------------------------------
echo "â³ Starting Minikube cluster..."
minikube start

# ------------------------------------
# Verify cluster is running
# ------------------------------------
echo "ğŸ” Checking cluster status..."
kubectl cluster-info

# ------------------------------------
# Retrieve available pods
# ------------------------------------
echo "ğŸ“¦ Listing pods..."
kubectl get pods -A

echo "ğŸ‰ Kubernetes setup complete!"
