#!/bin/bash

echo "ğŸš€ Starting Kubernetes local setup..."

# -----------------------------
# 1. Check if Minikube is installed
# -----------------------------
if ! command -v minikube &> /dev/null
then
    echo "â— Minikube not found. Installing..."

    # Install minikube (Linux)
    if [[ "$OSTYPE" == "linux-gnu"* ]]; then
        curl -LO https://storage.googleapis.com/minikube/releases/latest/minikube-linux-amd64
        sudo install minikube-linux-amd64 /usr/local/bin/minikube
        rm minikube-linux-amd64

    # Install minikube (MacOS)
    elif [[ "$OSTYPE" == "darwin"* ]]; then
        brew install minikube
    else
        echo "âŒ Unsupported OS. Please install Minikube manually."
        exit 1
    fi

    echo "âœ… Minikube installed successfully!"
else
    echo "âœ” Minikube is already installed."
fi

# -----------------------------
# 2. Start Minikube cluster
# -----------------------------
echo "â³ Starting Minikube cluster..."
minikube start

if [ $? -ne 0 ]; then
  echo "âŒ Failed to start Minikube cluster."
  exit 1
fi
echo "âœ… Minikube cluster started!"

# -----------------------------
# 3. Verify cluster info
# -----------------------------
echo "ğŸ” Verifying cluster status..."
kubectl cluster-info

if [ $? -ne 0 ]; then
  echo "âŒ Cluster is not running."
  exit 1
fi

echo "âœ… Cluster is running properly!"

# -----------------------------
# 4. Retrieve available pods
# -----------------------------
echo "ğŸ“¦ Fetching available pods..."
kubectl get pods -A

echo "ğŸ‰ Kubernetes setup completed successfully!"
